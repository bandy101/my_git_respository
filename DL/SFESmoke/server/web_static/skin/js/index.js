"use strict";var me=function(){var allConfigurationStatus="",selectedId="",getPermission=function(e){require(["../module/ajax","../module/prompt"],function(t,n){t.data({method:"GET",url:"/api/permission",type:"JSON",success:function(t){t.success?e(t.content):setTimeout(function(){return n.errorShow(t.content,function(){}),!1},1e3)},error:function(){return n.errorShow("网络错误",function(){}),!1}})})},initPage=function(e){var t=null;0==e||1==e?t="smokeDetector":2==e&&(t="smokeDetectorAll"),require(["../module/ajax","../module/prompt"],function(n,o){n.data({method:"GET",url:"/html/"+t+".html",data:{v:Math.ceil(1e6*Math.random())},success:function(t){t?(document.getElementById("main").innerHTML=t,me.getSystemName(),me.initConfigurationList(e),me.initConfigurationBtn(e),me.initTabSwitch(),2==e&&me.checkAutoStartStatus()):setTimeout(function(){return o.errorShow(data.content,function(){}),!1},1e3)},error:function(){return o.errorShow("请先登陆",function(){location.href="/login.html"}),!1}})})},getSystemName=function(){require(["../module/ajax","../module/prompt"],function(e,t){e.data({method:"GET",url:"/api/server_name",type:"JSON",success:function(e){e.success?(document.getElementById("system__name").innerHTML=e.content,document.getElementsByTagName("title")[0].innerHTML=e.content):setTimeout(function(){return t.errorShow(e.content,function(){}),!1},1e3)},error:function(){return t.errorShow("网络错误",function(){}),!1}})})},initConfigurationList=function(e,t){clearInterval(allConfigurationStatus),require(["../module/ajax","../module/prompt"],function(n,o){var i="";0==e||1==e?i="/api/status":2==e&&(i="/api/config"),n.data({method:"GET",async:!1,url:i,type:"JSON",success:function(n){if(n.success){for(var i="",u="",c=0;c<n.content.length;c++){var r=c+1;i+='<tr data-id="'+n.content[c].id+'" data-border="'+JSON.stringify(n.content[c].border)+'"><td>'+r+"</td><td>"+n.content[c].name+'</td><td class="status">'+n.content[c].status+"</td>",n.content[c].rtmp?i+='<td class="rtmp__status">已推送</td>':i+='<td class="rtmp__status">未推送</td>',0==e||1==e?i+="<td>":2==e&&(i+='<td><button type="button" class="table__button btn__reload" data-id="'+n.content[c].id+'">重载</button>'),i+='<button type="button" class="table__button check__record" data-id="'+n.content[c].id+'">查看记录</button>',0==e||1==e?i+="</td></tr>":2==e&&(i+='<button type="button" class="table__button check__live" data-id="'+n.content[c].id+'">查看直播</button></td></tr>'),u+='<option value ="'+n.content[c].id+'">'+n.content[c].name+"</option>"}document.getElementById("configuration__list__body").innerHTML=i,2==e&&(document.getElementById("site__list").innerHTML=u),selectedId="",me.initSelectConfigurationItem(e),me.initReloadOneConfigurationBtn(),me.initCheckRecordBtn(e),2==e&&me.initCheckLiveBtn(),me.getAllConfigurationStatus(),t||me.updateAllConfigurationStatus()}else setTimeout(function(){return o.errorShow(n.content,function(){}),!1},1e3)},error:function(){return o.errorShow("网络错误",function(){}),!1}})})},initConfigurationBtn=function(e){if(document.getElementById("btn__refresh").onclick=function(){me.initConfigurationList(e)},document.getElementById("record__close").onclick=function(){document.getElementById("record").style.display="none"},2==e){document.getElementById("btn__start__all").onclick=function(){me.startAllConfiguration(e)},document.getElementById("btn__stop__all").onclick=function(){me.stopAllConfiguration(e)},document.getElementById("btn__shut__down__all").onclick=function(){me.shutDownAllConfiguration(e)};var t=document.getElementById("checkbox__auto__start__all");t.onchange=function(){t.checked?me.setStartAutoStartStatus():me.setStopAutoStartStatus()},document.getElementById("btn__start__one").onclick=function(){me.startOneConfiguration(selectedId)},document.getElementById("btn__stop__one").onclick=function(){me.stopOneConfiguration(selectedId)},document.getElementById("btn__shut__down__one").onclick=function(){me.shutDownOneConfiguration(selectedId)},document.getElementById("btn__restart__one").onclick=function(){me.restartOneConfiguration(selectedId)},document.getElementById("btn__start__one__rtmp").onclick=function(){me.startOneConfigurationRTMP(selectedId)},document.getElementById("btn__stop__one__rtmp").onclick=function(){me.stopOneConfigurationRTMP(selectedId)};var n=document.getElementById("checkbox__start__time");n.onchange=function(){if(n.checked)(e=document.getElementById("start__time")).removeAttribute("disabled");else{var e=document.getElementById("start__time");e.disabled="disabled"}};var o=document.getElementById("checkbox__stop__time");o.onchange=function(){if(o.checked)(e=document.getElementById("stop__time")).removeAttribute("disabled");else{var e=document.getElementById("stop__time");e.disabled="disabled"}},document.getElementById("btn__set__border").onclick=function(){require(["../module/prompt"],function(e){if(!selectedId)return e.errorShow("请选择配置",function(){}),!1;me.initBorder(selectedId)})},document.getElementById("btn__top__add").onclick=function(){var e=document.getElementById("border__img");e.style.cursor="crosshair",e.type="top"},document.getElementById("btn__top__delete").onclick=function(){var e=document.getElementById("text__top"),t=e.value;""==t.substring(0,t.lastIndexOf(",["))?e.value="":e.value=t.substring(0,t.lastIndexOf(",["))+"]"},document.getElementById("btn__bottom__add").onclick=function(){var e=document.getElementById("border__img");e.style.cursor="crosshair",e.type="bottom"},document.getElementById("btn__bottom__delete").onclick=function(){var e=document.getElementById("text__bottom"),t=e.value;""==t.substring(0,t.lastIndexOf(",["))?e.value="":e.value=t.substring(0,t.lastIndexOf(",["))+"]"},document.getElementById("border__img").onclick=function(e){var t=document.getElementById("border__img");if("crosshair"==t.style.cursor&&"top"==t.type){var n=document.getElementById("text__top"),o=(100*e.offsetX/t.width).toFixed(2),i=(100*(t.height-e.offsetY)/t.height).toFixed(2);""==n.value?n.value="[["+o+","+i+"]]":n.value=n.value.substring(0,n.value.length-1)+",["+o+","+i+"]]"}else if("crosshair"==t.style.cursor&&"bottom"==t.type){var u=document.getElementById("text__bottom"),o=(100*e.offsetX/t.width).toFixed(2),i=(100*(t.height-e.offsetY)/t.height).toFixed(2);""==u.value?u.value="[["+o+","+i+"]]":u.value=u.value.substring(0,u.value.length-1)+",["+o+","+i+"]]"}},document.getElementById("btn__border__ok").onclick=function(){require(["../module/prompt"],function(e){var t=document.getElementById("text__top"),n=document.getElementById("text__bottom"),o=document.getElementById("configuration__list__body").getElementsByClassName("selected");if(""==t.value&&""!=n.value)return e.errorShow("请添加上边界",function(){}),!1;if(""!=t.value&&""==n.value)return e.errorShow("请添加下边界",function(){}),!1;""!=t.value&&""!=n.value?o[0].setAttribute("data-border","["+t.value+","+n.value+"]"):o[0].setAttribute("data-border",null),document.getElementById("border").style.display="none";var i=document.getElementById("border__img");i.style.cursor="default",i.type=""})},document.getElementById("btn__border__cancel").onclick=function(){document.getElementById("border").style.display="none";var e=document.getElementById("border__img");e.style.cursor="default",e.type=""},document.getElementById("btn__save__config").onclick=function(){me.saveConfiguration(selectedId,e)},document.getElementById("btn__add__config").onclick=function(){me.addConfiguration(e)},document.getElementById("btn__delete__config").onclick=function(){me.deleteConfiguration(selectedId,e)},document.getElementById("btn__log__refresh").onclick=function(){me.loadLog()},document.getElementById("btn__log__one__refresh").onclick=function(){me.loadOneLog()},document.getElementById("live__close").onclick=function(){videojs("my__video").dispose(),document.getElementById("live").style.display="none"}}},initSelectConfigurationItem=function(e){for(var t=document.getElementById("configuration__list__body").getElementsByTagName("tr"),n=0;n<t.length;n++)t[n].onclick=function(){for(var n=0;n<t.length;n++)t[n].classList.remove("selected");selectedId=this.getAttribute("data-id"),this.classList.add("selected"),2==e&&me.initConfigurationItemInfo(selectedId)}},initReloadOneConfigurationBtn=function(){for(var e=document.getElementsByClassName("btn__reload"),t=0;t<e.length;t++)e[t].onclick=function(){var e=this.getAttribute("data-id");me.reloadOneConfiguration(e)}},initCheckRecordBtn=function(e){for(var t=document.getElementsByClassName("check__record"),n=0;n<t.length;n++)t[n].onclick=function(){var t=this.getAttribute("data-id");me.initRecord(t,e)}},initRecord=function(e,t){require(["../module/ajax","../module/prompt","../module/loading"],function(n,o,i){i.show(),n.data({method:"GET",async:!1,url:"/api/record/"+e,type:"JSON",success:function(n){n.success?n.content.length>0?i.hide(function(){for(var o=document.getElementById("record__list"),i="",u=0;u<n.content.length;u++){var c=u+1;n.content[u].status?n.content[u].status="已确认":n.content[u].status="未确认",0==u?i='<tr data-pid="'+e+'" data-id="'+n.content[u].id+'" class="check__record__detail selected"><td>'+c+"</td><td>"+n.content[u].name+"</td><td>"+n.content[u].status+"</td><td>"+n.content[u].upload+"</td></tr>":i+='<tr data-pid="'+e+'" data-id="'+n.content[u].id+'" class="check__record__detail"><td>'+c+"</td><td>"+n.content[u].name+"</td><td>"+n.content[u].status+"</td><td>"+n.content[u].upload+"</td></tr>"}o.innerHTML=i,me.initCheckRecordDetail(t),me.getRecordDetailInfo(e,n.content[0].id,t),document.getElementById("record").style.display="inline-block"}):setTimeout(function(){return i.hide(function(){o.errorShow("该站点没有检测记录",function(){})}),!1},1e3):setTimeout(function(){return i.hide(function(){o.errorShow(n.content,function(){})}),!1},1e3)},error:function(){return i.hide(function(){o.errorShow("网络错误",function(){})}),!1}})})},initCheckLiveBtn=function(){for(var e=document.getElementsByClassName("check__live"),t=0;t<e.length;t++)e[t].onclick=function(){var e=this;require(["../module/prompt"],function(t){for(var n=document.getElementById("configuration__list__body").getElementsByClassName("selected")[0].getElementsByTagName("td"),o=0;o<n.length;o++)if("rtmp__status"==n[o].className&&"已推送"!=n[o].innerHTML)return t.errorShow("请启动推送",function(){}),!1;var i=e.getAttribute("data-id");me.initLive(i)})}},initLive=function(e){document.getElementById("video__contain").innerHTML='<video id="my__video" class="video-js" controls preload="none" width="580" data-setup="{}"><source src="" type="rtmp/flv"></video>',require(["../module/ajax","../module/prompt","../module/loading"],function(t,n,o){o.show(),t.data({method:"GET",url:"/api/rtmp_host",type:"JSON",success:function(t){t.success?o.hide(function(){videojs("my__video").src("rtmp://"+t.content+"/live/"+e),document.getElementById("live").style.display="block"}):setTimeout(function(){return o.hide(function(){n.errorShow(t.content,function(){})}),!1},1e3)},error:function(){return o.hide(function(){n.errorShow("网络错误",function(){})}),!1}})})},getRecordDetailInfo=function(e,t,n){require(["../module/ajax","../module/prompt","../module/loading","../module/date"],function(o,i,u,c){u.show(),o.data({method:"GET",async:!1,url:"/api/record/"+e+"/"+t,type:"JSON",success:function(e){e.success?u.hide(function(){var t=document.getElementById("table__record__detail"),o=c.dateFormat(e.content.timestamp),i=null;0==n?(i="<tr><td>"+e.content.st_name+"</td><td>"+e.content.Ringelmann+"</td><td>"+e.content.plate+"</td><td>"+e.content.plate_type+"</td><td>"+e.content.plate_color+"</td><td>"+e.content.vehicle_type+"</td><td>"+e.content.vehicle_color+"</td><td>"+e.content.lane+"</td><td>"+o+"</td></tr>",t.innerHTML=i):1!=n&&2!=n||(i="<tr><td>"+e.content.st_name+'</td><td id="recordRingelmann"><input type="number" class="table__input__min" min="0" max="5" value="'+e.content.Ringelmann+'"></td><td id="recordPlate"><input type="type" class="table__input__max" value="'+e.content.plate+'"></td><td id="recordPlateType"></td><td id="recordPlateColor"></td><td id="recordVehicleType"></td><td id="recordVehicleColor"></td><td id="recordLane"><input type="number" class="table__input__min" min="1" value="'+e.content.lane+'"></td><td>'+o+"</td></tr>",t.innerHTML=i,me.getSelectData("/api/list/plate_type","recordPlateType",e.content.plate_type),me.getSelectData("/api/list/plate_color","recordPlateColor",e.content.plate_color),me.getSelectData("/api/list/vehicle_type","recordVehicleType",e.content.vehicle_type),me.getSelectData("/api/list/vehicle_color","recordVehicleColor",e.content.vehicle_color)),document.getElementById("image1").src=e.content.image1,document.getElementById("image2").src=e.content.image2,document.getElementById("video").src=e.content.video,0==n?(document.getElementById("btn__record__confirm").remove(),document.getElementById("btn__record__upload").remove()):(me.initRecordConfirmBtn(),me.initRecordUploadBtn())}):setTimeout(function(){return u.hide(function(){i.errorShow(e.content,function(){})}),!1},1e3)},error:function(){return u.hide(function(){i.errorShow("网络错误",function(){})}),!1}})})},initCheckRecordDetail=function(e){for(var t=document.getElementsByClassName("check__record__detail"),n=0;n<t.length;n++)t[n].onclick=function(n){for(var o=0;o<t.length;o++)t[o].classList.remove("selected");this.classList.add("selected");var i=this.getAttribute("data-pid"),u=this.getAttribute("data-id");me.getRecordDetailInfo(i,u,e)}},initRecordConfirmBtn=function(){document.getElementById("btn__record__confirm").onclick=function(){require(["../module/ajax","../module/prompt","../module/loading"],function(e,t,n){for(var o=document.getElementById("record__list").getElementsByTagName("tr"),i="",u="",c="",r=0;r<o.length;r++)"check__record__detail selected"==o[r].className&&(i=o[r],u=o[r].getAttribute("data-pid"),c=o[r].getAttribute("data-id"));n.show(),e.data({method:"GET",async:!1,url:"/api/record/"+u+"/"+c+"/status",type:"JSON",success:function(e){e.success?n.hide(function(){t.successShow("已确认",function(){i.getElementsByTagName("td")[2].innerHTML="已确认"})}):setTimeout(function(){return n.hide(function(){t.errorShow(e.content,function(){})}),!1},1e3)},error:function(){return n.hide(function(){t.errorShow("网络错误",function(){})}),!1}})})}},initRecordUploadBtn=function(){document.getElementById("btn__record__upload").onclick=function(){require(["../module/ajax","../module/prompt","../module/loading"],function(e,t,n){for(var o=document.getElementById("record__list").getElementsByTagName("tr"),i="",u="",c="",r=0;r<o.length;r++)"check__record__detail selected"==o[r].className&&(i=o[r],u=o[r].getAttribute("data-pid"),c=o[r].getAttribute("data-id"));t.choiceShow("是否上传该记录？",function(){n.show(),e.data({method:"POST",url:"/api/record/"+u+"/"+c+"/upload",type:"JSON",request:"json",data:{Ringelmann:parseInt(document.getElementById("recordRingelmann").getElementsByTagName("input")[0].value),plate:document.getElementById("recordPlate").getElementsByTagName("input")[0].value,plate_type:document.getElementById("recordPlateType").getElementsByTagName("select")[0].value,plate_color:document.getElementById("recordPlateColor").getElementsByTagName("select")[0].value,vehicle_type:document.getElementById("recordVehicleType").getElementsByTagName("select")[0].value,vehicle_color:document.getElementById("recordVehicleColor").getElementsByTagName("select")[0].value,lane:parseInt(document.getElementById("recordLane").getElementsByTagName("input")[0].value)},success:function(e){e.success?n.hide(function(){t.successShow("上传成功",function(){i.getElementsByTagName("td")[2].innerHTML="已确认",i.getElementsByTagName("td")[3].innerHTML="等待上传"})}):setTimeout(function(){return n.hide(function(){t.errorShow(e.content,function(){})}),!1},1e3)},error:function(){return n.hide(function(){t.errorShow("网络错误",function(){})}),!1}})},function(){t.choiceHide(function(){})})})}},initConfigurationItemInfo=function(e){require(["../module/ajax","../module/prompt"],function(t,n){t.data({method:"GET",async:!1,url:"/api/config/"+e,type:"JSON",success:function(e){if(e.success){document.getElementById("config__number").value=e.content.id,document.getElementById("config__name").value=e.content.name,document.getElementById("config__video__source").value=e.content.video_source,document.getElementById("config__save__path").value=e.content.save_path;var t=document.getElementById("checkbox__start__time"),o=document.getElementById("start__time");o.value=e.content.start_time,null!=o.value&&void 0!=o.value&&""!=o.value?(t.checked="checked",void 0!=o.disabled&&o.removeAttribute("disabled")):(t.checked="",o.disabled="disabled");var i=document.getElementById("checkbox__stop__time"),u=document.getElementById("stop__time");u.value=e.content.stop_time,null!=u.value&&void 0!=u.value&&""!=u.value?(i.checked="checked",void 0!=u.disabled&&u.removeAttribute("disabled")):(i.checked="",u.disabled="disabled"),document.getElementById("Ringelmann").value=e.content.Ringelmann,document.getElementById("upload__func").value=e.content.upload_func}else setTimeout(function(){return n.errorShow(e.content,function(){}),!1},1e3)},error:function(){return n.errorShow("网络错误",function(){}),!1}})})},updateAllConfigurationStatus=function(){allConfigurationStatus=setInterval(function(){me.getAllConfigurationStatus()},3e3)},getAllConfigurationStatus=function(){require(["../module/ajax"],function(e){e.data({method:"GET",async:!1,url:"/api/status",type:"JSON",success:function(e){if(e.success)for(var t=document.getElementsByClassName("status"),n=document.getElementsByClassName("rtmp__status"),o=0;o<e.content.length;o++){t[o].innerHTML=e.content[o].status;var i="";i=e.content[o].rtmp?"已推送":"未推送",n[o].innerHTML=i}}})})},reloadOneConfiguration=function(e){require(["../module/ajax","../module/prompt","../module/loading"],function(t,n,o){if(!e)return n.errorShow("请选择配置",function(){}),!1;o.show(),t.data({method:"GET",async:!1,url:"/api/config/"+e,type:"JSON",data:{action:"reload"},success:function(e){e.success?o.hide(function(){n.successShow("已重载该配置",function(){})}):setTimeout(function(){return o.hide(function(){n.errorShow(e.content,function(){})}),!1},1e3)},error:function(){return o.hide(function(){n.errorShow("网络错误",function(){})}),!1}})})},startAllConfiguration=function(e){require(["../module/ajax","../module/prompt","../module/loading"],function(t,n,o){o.show(),t.data({method:"GET",async:!1,url:"/api/config",type:"JSON",data:{action:"startAll"},success:function(t){t.success?o.hide(function(){n.successShow("已全部开始",function(){me.initConfigurationList(e)})}):setTimeout(function(){return o.hide(function(){n.errorShow(t.content,function(){})}),!1},1e3)},error:function(){return o.hide(function(){n.errorShow("网络错误",function(){})}),!1}})})},stopAllConfiguration=function(e){require(["../module/ajax","../module/prompt","../module/loading"],function(t,n,o){o.show(),t.data({method:"GET",async:!1,url:"/api/config",type:"JSON",data:{action:"stopAll"},success:function(t){t.success?o.hide(function(){n.successShow("已全部停止",function(){me.initConfigurationList(e,!0)})}):setTimeout(function(){return o.hide(function(){n.errorShow(t.content,function(){})}),!1},1e3)},error:function(){return o.hide(function(){n.errorShow("网络错误",function(){})}),!1}})})},shutDownAllConfiguration=function(e){require(["../module/ajax","../module/prompt","../module/loading"],function(t,n,o){o.show(),t.data({method:"GET",async:!1,url:"/api/config",type:"JSON",data:{action:"shutdownAll"},success:function(t){t.success?o.hide(function(){n.successShow("已全部关闭",function(){me.initConfigurationList(e,!0)})}):setTimeout(function(){return o.hide(function(){n.errorShow(t.content,function(){})}),!1},1e3)},error:function(){return o.hide(function(){n.errorShow("网络错误",function(){})}),!1}})})},checkAutoStartStatus=function(){require(["../module/ajax","../module/prompt"],function(e,t){e.data({method:"GET",async:!1,url:"/api/autostart",type:"JSON",success:function(e){if(e.success){var n=document.getElementById("checkbox__auto__start__all");e.content&&(n.checked="checked")}else setTimeout(function(){return t.errorShow(e.content,function(){}),!1},1e3)},error:function(){return t.errorShow("网络错误",function(){}),!1}})})},setStartAutoStartStatus=function(){require(["../module/ajax","../module/prompt","../module/loading"],function(e,t,n){n.show(),e.data({method:"GET",async:!1,url:"/api/autostart",type:"JSON",data:{action:"start"},success:function(e){e.success?n.hide(function(){t.successShow("设置启动自动启动成功",function(){})}):setTimeout(function(){return n.hide(function(){t.errorShow(e.content,function(){})}),!1},1e3)},error:function(){return n.hide(function(){t.errorShow("网络错误",function(){})}),!1}})})},setStopAutoStartStatus=function(){require(["../module/ajax","../module/prompt","../module/loading"],function(e,t,n){n.show(),e.data({method:"GET",async:!1,url:"/api/autostart",type:"JSON",data:{action:"stop"},success:function(e){e.success?n.hide(function(){t.successShow("设置停止自动启动成功",function(){})}):setTimeout(function(){return n.hide(function(){t.errorShow(e.content,function(){})}),!1},1e3)},error:function(){return n.hide(function(){t.errorShow("网络错误",function(){})}),!1}})})},startOneConfiguration=function(e){require(["../module/ajax","../module/prompt","../module/loading"],function(t,n,o){if(!e)return n.errorShow("请选择配置",function(){}),!1;o.show(),t.data({method:"GET",async:!1,url:"/api/config/"+e,type:"JSON",data:{action:"start"},success:function(e){e.success?o.hide(function(){n.successShow("已启动",function(){})}):setTimeout(function(){return o.hide(function(){n.errorShow(e.content,function(){})}),!1},1e3)},error:function(){return o.hide(function(){n.errorShow("网络错误",function(){})}),!1}})})},stopOneConfiguration=function(e){require(["../module/ajax","../module/prompt","../module/loading"],function(t,n,o){if(!e)return n.errorShow("请选择配置",function(){}),!1;o.show(),t.data({method:"GET",async:!1,url:"/api/config/"+e,type:"JSON",data:{action:"stop"},success:function(e){e.success?o.hide(function(){n.successShow("已停止",function(){})}):setTimeout(function(){return o.hide(function(){n.errorShow(e.content,function(){})}),!1},1e3)},error:function(){return o.hide(function(){n.errorShow("网络错误",function(){})}),!1}})})},shutDownOneConfiguration=function(e){require(["../module/ajax","../module/prompt","../module/loading"],function(t,n,o){if(!e)return n.errorShow("请选择配置",function(){}),!1;o.show(),t.data({method:"GET",async:!1,url:"/api/config/"+e,type:"JSON",data:{action:"shutdown"},success:function(e){e.success?o.hide(function(){n.successShow("已关闭",function(){})}):setTimeout(function(){return o.hide(function(){n.errorShow(e.content,function(){})}),!1},1e3)},error:function(){return o.hide(function(){n.errorShow("网络错误",function(){})}),!1}})})},restartOneConfiguration=function(e){require(["../module/ajax","../module/prompt","../module/loading"],function(t,n,o){if(!e)return n.errorShow("请选择配置",function(){}),!1;o.show(),t.data({method:"GET",async:!1,url:"/api/config/"+e,type:"JSON",data:{action:"restart"},success:function(e){e.success?o.hide(function(){n.successShow("已重启",function(){})}):setTimeout(function(){return o.hide(function(){n.errorShow(e.content,function(){})}),!1},1e3)},error:function(){return o.hide(function(){n.errorShow("网络错误",function(){})}),!1}})})},startOneConfigurationRTMP=function(e){require(["../module/ajax","../module/prompt","../module/loading"],function(t,n,o){if(!e)return n.errorShow("请选择配置",function(){}),!1;o.show(),t.data({method:"GET",async:!1,url:"/api/rtmp/"+e,type:"JSON",data:{action:"start"},success:function(e){e.success?o.hide(function(){n.successShow("已开始推送",function(){})}):setTimeout(function(){return o.hide(function(){n.errorShow(e.content,function(){})}),!1},1e3)},error:function(){return o.hide(function(){n.errorShow("网络错误",function(){})}),!1}})})},stopOneConfigurationRTMP=function(e){require(["../module/ajax","../module/prompt","../module/loading"],function(t,n,o){if(!e)return n.errorShow("请选择配置",function(){}),!1;o.show(),t.data({method:"GET",async:!1,url:"/api/rtmp/"+e,type:"JSON",data:{action:"stop"},success:function(e){e.success?o.hide(function(){n.successShow("已停止推送",function(){})}):setTimeout(function(){return o.hide(function(){n.errorShow(e.content,function(){})}),!1},1e3)},error:function(){return o.hide(function(){n.errorShow("网络错误",function(){})}),!1}})})},initBorder=function(e){require(["../module/ajax","../module/prompt","../module/loading"],function(t,n,o){o.show(),t.data({method:"GET",url:"/api/frame/"+e,type:"JSON",success:function(e){e.success?o.hide(function(){document.getElementById("border__img").src=e.content,document.getElementById("border").style.display="inline-block";var t=document.getElementById("text__top"),n=document.getElementById("text__bottom"),o=document.getElementById("configuration__list__body").getElementsByClassName("selected")[0].getAttribute("data-border");""!=o&&"null"!=o&&void 0!=o?(t.value=o.substring(1,o.indexOf("]],[[")+2),n.value=o.substring(o.indexOf("]],[[")+3,o.length-1)):(t.value="",n.value="")}):setTimeout(function(){return o.hide(function(){document.getElementById("border").style.display="none",n.errorShow(e.content,function(){})}),!1},1e3)},error:function(){return o.hide(function(){n.errorShow("网络错误",function(){})}),!1}})})},saveConfiguration=function(id,permissionValue){require(["../module/ajax","../module/prompt","../module/loading"],function(ajaxModule,promptModule,loadingModule){if(!id)return promptModule.errorShow("请选择配置",function(){}),!1;var configNameValue=document.getElementById("config__name").value,configVideoSourceValue=document.getElementById("config__video__source").value,configSavePathValue=document.getElementById("config__save__path").value,startTimeValue=document.getElementById("start__time").value,stopTimeValue=document.getElementById("stop__time").value,RingelmannValue=document.getElementById("Ringelmann").value,uploadFuncValue=document.getElementById("upload__func").value,borderValue=document.getElementById("configuration__list__body").getElementsByClassName("selected")[0].getAttribute("data-border"),checkboxStartTimeValue=document.getElementById("checkbox__start__time"),checkboxStopTimeValue=document.getElementById("checkbox__stop__time");checkboxStartTimeValue.checked||(startTimeValue=null),checkboxStopTimeValue.checked||(stopTimeValue=null);var reg=/^[0-9]\d*$/;if(!reg.test(RingelmannValue)||!(RingelmannValue>=0&&RingelmannValue<=5))return promptModule.errorShow("请输入0~5的整数值",function(){}),!1;loadingModule.show(),ajaxModule.data({method:"PUT",url:"/api/config/"+id,type:"JSON",request:"json",data:{id:id,name:configNameValue,upload_func:uploadFuncValue,video_source:configVideoSourceValue,Ringelmann:parseInt(RingelmannValue),save_path:configSavePathValue,border:eval(borderValue),start_time:startTimeValue,stop_time:stopTimeValue},success:function(e){e.success?loadingModule.hide(function(){promptModule.successShow("保存成功",function(){me.initConfigurationList(permissionValue)})}):setTimeout(function(){return loadingModule.hide(function(){promptModule.errorShow(e.content,function(){})}),!1},1e3)},error:function(){return loadingModule.hide(function(){promptModule.errorShow("网络错误",function(){})}),!1}})})},addConfiguration=function(permissionValue){require(["../module/ajax","../module/prompt","../module/loading"],function(ajaxModule,promptModule,loadingModule){var configNumberValue=document.getElementById("config__number").value,configNameValue=document.getElementById("config__name").value,configVideoSourceValue=document.getElementById("config__video__source").value,configSavePathValue=document.getElementById("config__save__path").value,startTimeValue=document.getElementById("start__time").value,stopTimeValue=document.getElementById("stop__time").value,RingelmannValue=document.getElementById("Ringelmann").value,uploadFuncValue=document.getElementById("upload__func").value,borderValue=null,checkboxStartTimeValue=document.getElementById("checkbox__start__time"),checkboxStopTimeValue=document.getElementById("checkbox__stop__time");checkboxStartTimeValue.checked||(startTimeValue=null),checkboxStopTimeValue.checked||(stopTimeValue=null);var reg=/^[0-9]\d*$/;if(!reg.test(RingelmannValue)||!(RingelmannValue>=0&&RingelmannValue<=5))return promptModule.errorShow("请输入0~5的整数值",function(){}),!1;loadingModule.show(),ajaxModule.data({method:"POST",url:"/api/config/"+configNumberValue,type:"JSON",request:"json",data:{id:configNumberValue,name:configNameValue,upload_func:uploadFuncValue,video_source:configVideoSourceValue,Ringelmann:parseInt(RingelmannValue),save_path:configSavePathValue,border:eval(borderValue),start_time:startTimeValue,stop_time:stopTimeValue},success:function(e){e.success?loadingModule.hide(function(){promptModule.successShow("添加成功",function(){me.initConfigurationList(permissionValue)})}):setTimeout(function(){return loadingModule.hide(function(){promptModule.errorShow(e.content,function(){})}),!1},1e3)},error:function(){return loadingModule.hide(function(){promptModule.errorShow("网络错误",function(){})}),!1}})})},deleteConfiguration=function(e,t){require(["../module/ajax","../module/prompt","../module/loading"],function(n,o,i){if(!e)return o.errorShow("请选择配置",function(){}),!1;o.choiceShow("是否删除该站点？",function(){i.show(),n.data({method:"DELETE",url:"/api/config/"+e,type:"JSON",request:"json",success:function(e){e.success?i.hide(function(){o.successShow("删除成功",function(){me.initConfigurationList(t)})}):setTimeout(function(){return i.hide(function(){o.errorShow(e.content,function(){})}),!1},1e3)},error:function(){return i.hide(function(){o.errorShow("网络错误",function(){})}),!1}})},function(){o.choiceHide(function(){})})})},loadLog=function(){require(["../module/ajax","../module/prompt"],function(e,t){e.data({method:"GET",async:!1,url:"/api/log",type:"JSON",success:function(e){if(e.success){for(var n=document.getElementById("log__content"),o="",i=0;i<e.content.length;i++)o+=e.content[i]+"<br>";n.innerHTML=o}else setTimeout(function(){return t.errorShow(e.content,function(){}),!1},1e3)},error:function(){return t.errorShow("网络错误",function(){}),!1}})})},loadOneLog=function(){var e=document.getElementById("site__list"),t=e.selectedIndex,n=e.options[t].value;require(["../module/ajax","../module/prompt"],function(e,t){e.data({method:"GET",async:!1,url:"/api/log/"+n,type:"JSON",success:function(e){if(e.success){for(var n=document.getElementById("log__one__content"),o="",i=0;i<e.content.length;i++)o+=e.content[i]+"<br>";n.innerHTML=o}else setTimeout(function(){return t.errorShow(e.content,function(){}),!1},1e3)},error:function(){return t.errorShow("网络错误",function(){}),!1}})})},initTabSwitch=function(){for(var e=document.getElementsByClassName("tab__title"),t=0;t<e.length;t++)e[t].onclick=function(){for(var t=document.getElementsByClassName("tab__content"),n=0;n<t.length;n++)t[n].classList.remove("tab__content__active"),e[n].classList.remove("tab__title__active");t[this.id].classList.add("tab__content__active"),this.classList.add("tab__title__active")}},getSelectData=function(e,t,n){require(["../module/ajax","../module/prompt"],function(o,i){o.data({method:"GET",async:!1,url:e,type:"JSON",success:function(e){if(e.success){for(var o="",u=0;u<e.content.length;u++)o+='<option value="'+e.content[u]+'">'+e.content[u]+"</option>";var c='<select class="table__select">'+o+"</select>";document.getElementById(t).innerHTML=c,document.getElementById(t).getElementsByTagName("select")[0].value=n}else setTimeout(function(){return i.errorShow(e.content,function(){}),!1},1e3)},error:function(){return i.errorShow("网络错误",function(){}),!1}})})};return{getPermission:getPermission,initPage:initPage,getSystemName:getSystemName,initConfigurationList:initConfigurationList,initConfigurationBtn:initConfigurationBtn,initSelectConfigurationItem:initSelectConfigurationItem,initReloadOneConfigurationBtn:initReloadOneConfigurationBtn,initCheckRecordBtn:initCheckRecordBtn,initRecord:initRecord,initCheckLiveBtn:initCheckLiveBtn,initLive:initLive,getRecordDetailInfo:getRecordDetailInfo,initCheckRecordDetail:initCheckRecordDetail,initRecordConfirmBtn:initRecordConfirmBtn,initRecordUploadBtn:initRecordUploadBtn,initConfigurationItemInfo:initConfigurationItemInfo,updateAllConfigurationStatus:updateAllConfigurationStatus,getAllConfigurationStatus:getAllConfigurationStatus,reloadOneConfiguration:reloadOneConfiguration,startAllConfiguration:startAllConfiguration,stopAllConfiguration:stopAllConfiguration,shutDownAllConfiguration:shutDownAllConfiguration,checkAutoStartStatus:checkAutoStartStatus,setStartAutoStartStatus:setStartAutoStartStatus,setStopAutoStartStatus:setStopAutoStartStatus,startOneConfiguration:startOneConfiguration,stopOneConfiguration:stopOneConfiguration,shutDownOneConfiguration:shutDownOneConfiguration,restartOneConfiguration:restartOneConfiguration,startOneConfigurationRTMP:startOneConfigurationRTMP,stopOneConfigurationRTMP:stopOneConfigurationRTMP,initBorder:initBorder,saveConfiguration:saveConfiguration,addConfiguration:addConfiguration,deleteConfiguration:deleteConfiguration,loadLog:loadLog,loadOneLog:loadOneLog,initTabSwitch:initTabSwitch,getSelectData:getSelectData}}();me.getPermission(function(e){me.initPage(e)});